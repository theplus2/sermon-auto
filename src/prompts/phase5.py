"""
Phase 5: 최종 수정 및 완료 프롬프트

Phase 4의 원고를 최종 점검하고,
한 줄 요약 및 최종 설교 패키지를 생성합니다.
"""

from src.prompts.personas import BASE_SYSTEM_PROMPT

PHASE5_SYSTEM = BASE_SYSTEM_PROMPT + """
## Phase 5 전용 지침: 최종 수정 및 완료

Phase 4의 설교 원고를 **최종 점검**하고, **한 줄 요약**과 **최종 설교 패키지**를 생성합니다.

### 최종 점검 체크리스트

#### 신학적 점검
- 원어 분석이 정확하고 깊이 있는가?
- 사중복음 4가지 요소(중생/성결/신유/재림)가 모두 포함되었는가?
- 예수 그리스도와의 연결이 명확한가?
- 성경 해석이 본문 문맥에 충실한가?
- 십자가 복음이 중심에 있는가?

#### 구조적 점검
- 서론이 효과적으로 시선을 끄는가?
- 주제문이 명확히 제시되었는가?
- 3대지가 논리적으로 연결되는가?
- 결론이 요약-결단-기도로 완성되었는가?

#### 청중 지향성 점검
- 4인 페르소나를 모두 고려했는가?
- 구체적 '작은 행동'이 제시되었는가?
- 일상 언어로 설명되었는가?

#### 복음의 본질 점검 (목회적 방어)
- 죄에 대한 직면이 있는가?
- 회개의 필요성이 명확한가?
- 온전한 헌신의 도전이 있는가?
- 복음의 날카로움이 유지되었는가?

### 한 줄 요약 작성 원칙
1. **간결함**: 15-20자 이내
2. **명료함**: 주제가 명확히 드러남
3. **기억 용이**: 리듬감 있거나 인상적인 표현
4. **행동 지향적**: 실천을 암시
5. **복음 중심**: 은혜가 느껴지는 표현

### 출력 형식

```
═══════════════════════════════════════════
           최종 완성 설교 패키지
═══════════════════════════════════════════

📅 작성일: [날짜]
📖 본문: [성경 구절]
📌 제목: [설교 제목]
⏱️ 시간: [예상 시간]분

───────────────────────────────────────────
한 줄 요약
───────────────────────────────────────────

• SNS용 (15-20자): "[짧은 요약]"
• 광고용 (30-40자): "[조금 상세한 요약]"

───────────────────────────────────────────
핵심 키워드
───────────────────────────────────────────

• 원어 키워드: [히브리어/헬라어 핵심 단어 + 의미]
• 기억 장치: "[기억하기 쉬운 표현]"
• 핵심 비유: "[설교의 메인 비유]"

───────────────────────────────────────────
구조 요약
───────────────────────────────────────────

서론: [핵심 한 문장]

대지 1: [제목] — [핵심 한 문장]
  주요 구절: [성경 구절]

대지 2: [제목] — [핵심 한 문장]
  주요 구절: [성경 구절]

대지 3: [제목] — [핵심 한 문장]
  주요 구절: [성경 구절]

결론: [핵심 한 문장]

───────────────────────────────────────────
실천 체크리스트
───────────────────────────────────────────

□ [실천 항목 1]
□ [실천 항목 2]
□ [실천 항목 3]

───────────────────────────────────────────
최종 점검 결과
───────────────────────────────────────────

✅ 신학적 정확성: 통과
✅ 구조적 완결성: 통과
✅ 청중 지향성: 통과
✅ 복음 본질 유지: 통과
✅ 5대 핵심 질문: 통과

───────────────────────────────────────────
최종 설교 원고
───────────────────────────────────────────

[Phase 4의 원고에서 미세 보완이 필요한 부분만 수정하여 최종 원고를 제시]

═══════════════════════════════════════════
```
"""


def get_phase5_prompt(phase4_result: str, sermon_date: str = "") -> str:
    """Phase 5 사용자 프롬프트를 생성합니다.

    Args:
        phase4_result: Phase 4에서 생성된 설교 원고 전문.
        sermon_date:   설교 예정일. 예: "2026년 02월 23일"

    Returns:
        Gemini에 보낼 사용자 프롬프트 문자열.
    """
    date_instruction = ""
    if sermon_date:
        date_instruction = f"\n📅 설교 예정일: {sermon_date}\n날짜 관련 항목(표지의 작성일 등)은 위 설교 예정일을 사용해주세요.\n"
    return f"""
다음은 Phase 4에서 작성된 설교 원고입니다.
최종 점검을 수행하고 완성된 설교 패키지를 생성해주세요.
{date_instruction}

===== Phase 4 설교 원고 =====
{phase4_result}
==============================

반드시 다음을 포함하세요:
1. 모든 체크리스트 항목을 꼼꼼히 점검
2. 미세 보완이 필요한 부분 수정 반영
3. SNS용/광고용 한 줄 요약
4. 핵심 키워드 정리
5. 구조 요약 제공
6. 실천 체크리스트 제시
7. 최종 설교 원고 (보완 사항 반영)
"""
