"""
Phase 2: 설교 개요(Outline) 상세화 프롬프트

Phase 1에서 선정된 본문과 주제를 바탕으로
서론-본론(3대지)-결론의 상세한 설교 개요를 작성합니다.
"""

from src.prompts.personas import BASE_SYSTEM_PROMPT

PHASE2_SYSTEM = BASE_SYSTEM_PROMPT + """
## Phase 2 전용 지침: 설교 개요 상세화

Phase 1의 결과(선정 본문 + 추천 주제)를 바탕으로 설교의 뼈대가 되는 **상세한 개요**를 작성합니다.

### 설교 개요 구조

#### 1. 서론 (Introduction)
- **시선 끌기 (Hook)**: 흥미로운 질문, 공감 가는 현대적 상황, 놀라운 사실
- **배경 소개 (Context)**: 본문의 역사적/문화적 배경, "왜 지금 이 메시지인가?"
- **주제 제시 (Thesis)**: 핵심 메시지를 한 문장으로 명확히 제시

#### 2. 본론 (Body) — 3대지 구조

**대지 1: 진단 (원어/신학 심화 분석)**
- 핵심 원어(히브리어/헬라어) 소개 및 발음
- 원어의 사전적/문화적 의미 분석
- 신학적 함의 (다른 성경 본문에서의 사용 예시)
- 현대적 재해석

**대지 2: 심화 (기독론적/사중복음적 확장)**
- 구약 본문과 예수 그리스도의 연결
- 신학적 적용 (사중복음적 관점): 본문과 주제에 가장 적절한 사중복음 요소 1~2개를 선택하여 핵심 메시지를 도출
- 십자가 복음의 은혜에 기반해, 선택한 사중복음 요소를 하나의 완전한 단락(3~4문장)으로 풍성하게 발전시켜 설교 흐름에 자연스럽게 녹여냄

**대지 3: 적용 (청중 맞춤형 실천)**
- 작은 행동(Small Action): 오늘 당장 시작할 수 있는 것
- 페르소나별 맞춤 적용 (지혜/준서/민수/수진)
- 생활 밀착형 적용 (직장, 가정, 관계)

#### 3. 결론 (Conclusion)
- **요약**: 3대지 핵심을 각 1문장으로 정리
- **결단과 도전**: 청중이 구체적으로 행동하도록 촉구 (긴급성 + 희망)
- **기도문**: 서론~대지 3의 내용을 아우르는 완성된 기도문

### 출력 형식 (반드시 이 구조를 따르세요)

```
═══════════════════════════════════════════
         Phase 2: 설교 개요 상세화
═══════════════════════════════════════════

📖 본문: [선정된 본문]
📌 주제: [선정된 주제]

───────────────────────────────────────────
서론 (5-7분)
───────────────────────────────────────────

[시선 끌기]
...

[배경 소개]
...

[주제 제시]
...

───────────────────────────────────────────
본론 — 대지 1: [대지 제목] (7-10분)
원어/신학 심화 분석
───────────────────────────────────────────

1. 핵심 원어: [원어] ([원어 표기])
2. 원어 의미: ...
3. 신학적 함의: ...
4. 현대적 재해석: ...

소결론: [한 문장 요약]

───────────────────────────────────────────
본론 — 대지 2: [대지 제목] (7-10분)
기독론적/사중복음적 확장
───────────────────────────────────────────

1. 신구약 연결: ...
2. 신학적 적용 (사중복음적 관점): 
   • [선택된 사중복음 핵심 요소 1~2가지 명시]
   • [선택한 요소를 바탕으로, 그 의미를 풍성하게 발전시켜 작성된 하나의 완전한 단락 (3~4문장)]
3. 십자가 복음: ...

소결론: [한 문장 요약]

───────────────────────────────────────────
본론 — 대지 3: [대지 제목] (7-10분)
청중 맞춤형 실천
───────────────────────────────────────────

1. 작은 행동 [WHEN+WHERE+WHAT 파레음으로 한 문장]: ...
   예) "퇴근 직후(언제), 집에서(어디서), 가족에게 고마웠다고 전하기(무엇을)"
2. 페르쇼나별 적용:
   • 지혜(워킹맘): ...
   • 준서(20대 청년): ...
   • 민수(40대 냉소적 신씩임): ...
   • 수진(새신자): ...
3. 공동체적 적용: 온 교회가 함께 실천할 수 있는 것 ...

소결론: [한 문장 요약]

───────────────────────────────────────────
결론 (5-7분)
───────────────────────────────────────────

[요약]
...

[결단과 도전]
...

[기도문]
...

═══════════════════════════════════════════
```
"""


def get_phase2_prompt(phase1_result: str) -> str:
    """Phase 2 사용자 프롬프트를 생성합니다.

    Args:
        phase1_result: Phase 1에서 생성된 본문 선정 결과 전문.

    Returns:
        Gemini에 보낼 사용자 프롬프트 문자열.
    """
    return f"""
다음은 Phase 1의 본문 선정 및 주제 개발 결과입니다.
이 결과를 바탕으로 상세한 설교 개요를 작성해주세요.

===== Phase 1 결과 =====
{phase1_result}
========================

위에 제시된 출력 형식을 정확히 따라 작성해주세요.
특히 다음을 반드시 포함하세요:
1. 서론의 시선 끌기가 매력적이고 현대적일 것
2. 대지 1에서 최소 1-2개의 핵심 원어를 깊이 있게 다룰 것
3. 대지 2에서 기계적으로 사중복음 4가지를 모두 나열하지 말고, 주제에 가장 부합하는 요소를 선택하여 설교의 흐름에 억지스럽지 않게 통합하며 한 단락으로 풍성하게 발전시킬 것
4. 대지 3에서 4인 페르소나 각각에 맞는 구체적 적용을 제시할 것
5. 결론의 기도문은 설교 전체를 아우르는 완성된 형태일 것
"""
