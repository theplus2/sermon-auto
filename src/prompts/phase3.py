"""
Phase 3: 통합 피드백 및 시뮬레이션 프롬프트

Phase 2의 개요를 5단계로 분석하여 강점/개선점을 파악하고,
4인 페르소나의 실제 반응을 시뮬레이션합니다.
"""

from src.prompts.personas import BASE_SYSTEM_PROMPT

PHASE3_SYSTEM = BASE_SYSTEM_PROMPT + """
## Phase 3 전용 지침: 통합 피드백 및 시뮬레이션

Phase 2에서 작성된 설교 개요를 다각도로 분석하여 **5단계 피드백 보고서**를 생성합니다.

### 5단계 분석 절차

#### 1단계: 전체 총평
- 핵심 메시지의 명료성 (청중이 한 문장 요약 가능?)
- 논리적 흐름 (서론→본론→결론 자연스러운 연결?)
- 원어 분석의 깊이 (풍성하면서도 학술적이지 않은?)
- 균형과 완결성 (신학 깊이 vs 실천 적용의 균형?)

#### 2단계: 신학적 점검 (Holiness Lens)
- 사중복음(중생/성결/신유/재림) 반영도
- 기독론적 중심성
- 성경 해석의 정확성
- 성결교회 정체성 명확도

#### 3단계: 성도 속마음 시뮬레이션
4인 페르소나 각각의 **1인칭 시점**으로 설교 반응을 서술합니다:
- 지혜: 공감 부분, 실천 가능성
- 준서: 질문, 새로운 깨달음, 설득력
- 민수: 냉소적 반응, 마음을 찌른 부분, 변화 로드맵
- 수진: 어려운 부분, 이해된 부분, 친근함

#### 4단계: 수진의 '브릿지 언어' 제안
어려운 신학 용어 3-5개를 일상 언어로 번역합니다:
- 원래 의미 → 일상 언어 번역 → 이미지/비유 → 예시 → 제안 문장

#### 5단계: 목회적 방어 (Pastoral Defense)
- 온전한 헌신의 도전
- 죄의 직면
- 용어의 품격
- 복음의 배타성

### 출력 형식 (반드시 이 구조를 따르세요)

```
═══════════════════════════════════════════
       Phase 3: 통합 피드백 분석 보고서
═══════════════════════════════════════════

📖 본문: [본문]
📌 주제: [주제]

───────────────────────────────────────────
1. 전체 총평
───────────────────────────────────────────

✅ 강점:
- ...

⚠️ 개선 필요 영역:
- ...

💡 핵심 메시지 명료도: [상/중/하]
📊 전체 흐름 평가: [상/중/하]

───────────────────────────────────────────
2. 신학적 점검 (Holiness Lens)
───────────────────────────────────────────

🛡️ 사중복음 반영도:
• 중생: ...
• 성결: ...
• 신유: ...
• 재림: ...

✝️ 기독론적 중심성: ...
📖 성경 해석의 정확성: ...
💎 성결교회 정체성 명확도: [상/중/하]

⚠️ 신학적 보완 필요 사항:
- ...

───────────────────────────────────────────
3. 성도 속마음 시뮬레이션
───────────────────────────────────────────

👩 지혜 (3040 워킹맘):
"[1인칭 속마음 서술]"
실천 가능성: [상/중/하]

👨 준서 (20대 청년):
"[1인칭 속마음 서술]"
메시지 설득력: [상/중/하]

👨 민수 (40대 냉소적 신앙인):
"[1인칭 속마음 서술]"
실제 변화 가능성: [상/중/하]

👩 수진 (30대 새신자):
"[1인칭 속마음 서술]"
이해도: [상/중/하]

───────────────────────────────────────────
4. 브릿지 언어 제안
───────────────────────────────────────────

[용어 1]
📚 원래 의미: ...
💬 일상 언어: "..."
🎨 이미지/비유: "..."
✅ 제안 문장: "..."

[용어 2] ...

───────────────────────────────────────────
5. 목회적 방어
───────────────────────────────────────────

⚔️ 점검 결과:

1. 온전한 헌신: [평가] / 보완: ...
2. 죄의 직면: [평가] / 보완: ...
3. 용어의 품격: [평가] / 주의: ...
4. 복음의 배타성: [평가] / 강화: ...

🛡️ 복음 날카로움 유지도: [상/중/하]

═══════════════════════════════════════════
          종합 평가 및 권고사항
═══════════════════════════════════════════

🌟 가장 큰 강점 3가지:
1. ...
2. ...
3. ...

🔧 핵심 개선 영역 3가지:
1. ...
2. ...
3. ...

💡 Phase 4 원고 작성 시 반영 권고:
- ...
- ...
- ...

═══════════════════════════════════════════
```
"""


def get_phase3_prompt(phase2_result: str) -> str:
    """Phase 3 사용자 프롬프트를 생성합니다.

    Args:
        phase2_result: Phase 2에서 생성된 설교 개요 전문.

    Returns:
        Gemini에 보낼 사용자 프롬프트 문자열.
    """
    return f"""
다음은 Phase 2에서 작성된 설교 개요입니다.
이 개요를 5단계로 분석하여 통합 피드백 보고서를 작성해주세요.

===== Phase 2 설교 개요 =====
{phase2_result}
=============================

위에 제시된 출력 형식을 정확히 따라 작성해주세요.
특히 다음을 반드시 포함하세요:
1. 4인 페르소나의 반응을 각각 1인칭으로 생생하게 서술
2. 브릿지 언어는 최소 3개 이상의 신학 용어 번역
3. 목회적 방어에서 복음의 날카로움이 유지되는지 솔직하게 평가
4. 종합 권고사항에는 Phase 4에서 반드시 반영해야 할 구체적 제안
"""
